<h2 mat-dialog-title>
  Add New Announcement
  <mat-icon
    fontIcon="close"
    class="text-danger close-icon"
    style="cursor: pointer"
    (click)="closeDialog()"
  ></mat-icon>
</h2>

<mat-dialog-content class="scrollable-container">
  <form [formGroup]="announcementForm">
    <div class="form-container">
      <mat-form-field
        appearance="outline"
        class="icon-width custom-form-field title-width mt-2"
      >
        <input
          style="width: auto; margin-left: -12px"
          matInput
          readonly
          [value]="selectedEmoji"
        />
        <button
          style="margin-left: -50px"
          mat-icon-button
          matSuffix
          (click)="toggleEmojiPicker($event, 'formField')"
        >
          <mat-icon *ngIf="!selectedEmoji"
            ><svg
              style="margin-left: 5px !important"
              width="21"
              height="21"
              viewBox="0 0 21 21"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_710_6226"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="21"
                height="21"
              >
                <rect x="0.5" y="0.5" width="20" height="20" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_710_6226)">
                <path
                  d="M13.4167 9.66663C13.764 9.66663 14.0591 9.5451 14.3022 9.30204C14.5452 9.05899 14.6667 8.76385 14.6667 8.41663C14.6667 8.0694 14.5452 7.77426 14.3022 7.53121C14.0591 7.28815 13.764 7.16663 13.4167 7.16663C13.0695 7.16663 12.7744 7.28815 12.5313 7.53121C12.2883 7.77426 12.1667 8.0694 12.1667 8.41663C12.1667 8.76385 12.2883 9.05899 12.5313 9.30204C12.7744 9.5451 13.0695 9.66663 13.4167 9.66663ZM7.58341 9.66663C7.93064 9.66663 8.22578 9.5451 8.46883 9.30204C8.71189 9.05899 8.83341 8.76385 8.83341 8.41663C8.83341 8.0694 8.71189 7.77426 8.46883 7.53121C8.22578 7.28815 7.93064 7.16663 7.58341 7.16663C7.23619 7.16663 6.94105 7.28815 6.698 7.53121C6.45494 7.77426 6.33341 8.0694 6.33341 8.41663C6.33341 8.76385 6.45494 9.05899 6.698 9.30204C6.94105 9.5451 7.23619 9.66663 7.58341 9.66663ZM10.5001 15.0833C11.4445 15.0833 12.3022 14.8159 13.073 14.2812C13.8438 13.7465 14.4029 13.0416 14.7501 12.1666H13.3751C13.0695 12.6805 12.6633 13.0868 12.1563 13.3854C11.6494 13.684 11.0973 13.8333 10.5001 13.8333C9.90286 13.8333 9.35078 13.684 8.84383 13.3854C8.33689 13.0868 7.93064 12.6805 7.62508 12.1666H6.25008C6.5973 13.0416 7.15633 13.7465 7.92716 14.2812C8.698 14.8159 9.55564 15.0833 10.5001 15.0833ZM10.5001 18.8333C9.3473 18.8333 8.26397 18.6145 7.25008 18.177C6.23619 17.7395 5.35425 17.1458 4.60425 16.3958C3.85425 15.6458 3.2605 14.7638 2.823 13.75C2.3855 12.7361 2.16675 11.6527 2.16675 10.5C2.16675 9.34718 2.3855 8.26385 2.823 7.24996C3.2605 6.23607 3.85425 5.35413 4.60425 4.60413C5.35425 3.85413 6.23619 3.26038 7.25008 2.82288C8.26397 2.38538 9.3473 2.16663 10.5001 2.16663C11.6529 2.16663 12.7362 2.38538 13.7501 2.82288C14.764 3.26038 15.6459 3.85413 16.3959 4.60413C17.1459 5.35413 17.7397 6.23607 18.1772 7.24996C18.6147 8.26385 18.8334 9.34718 18.8334 10.5C18.8334 11.6527 18.6147 12.7361 18.1772 13.75C17.7397 14.7638 17.1459 15.6458 16.3959 16.3958C15.6459 17.1458 14.764 17.7395 13.7501 18.177C12.7362 18.6145 11.6529 18.8333 10.5001 18.8333ZM10.5001 17.1666C12.3612 17.1666 13.9376 16.5208 15.2292 15.2291C16.5209 13.9375 17.1667 12.3611 17.1667 10.5C17.1667 8.63885 16.5209 7.06246 15.2292 5.77079C13.9376 4.47913 12.3612 3.83329 10.5001 3.83329C8.63897 3.83329 7.06258 4.47913 5.77091 5.77079C4.47925 7.06246 3.83341 8.63885 3.83341 10.5C3.83341 12.3611 4.47925 13.9375 5.77091 15.2291C7.06258 16.5208 8.63897 17.1666 10.5001 17.1666Z"
                  fill="#00569B"
                />
              </g>
            </svg>
          </mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field
        appearance="outline"
        class="custom-form-field title-width mt-2"
      >
        <mat-label>Title</mat-label>
        <input matInput placeholder="Title*" formControlName="title" />
        <mat-error *ngIf="announcementForm.get('title')?.hasError('required')">
          Title is required
        </mat-error>
      </mat-form-field>
    </div>
    <div class="editor-container">
      <div id="editor"></div>
      <div class="word-counter">{{ wordCount }}/{{ maxWordLimit }} words</div>
    </div>

    <div class="author-container">
      <mat-form-field
        appearance="outline"
        class="custom-form-field title-width mt-2"
      >
        <mat-label>Author</mat-label>
        <mat-select [(value)]="selectedAuthor">
          <mat-option *ngFor="let author of authorList" [value]="author">
            {{ author }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-checkbox class="mt-2" [disableRipple]="true"
        >Display Author</mat-checkbox
      >
    </div>

    <div class="date-container mt-1">
      <mat-form-field
        appearance="outline"
        class="date-width custom-form-field title-width mt-2"
      >
        <mat-label>Start</mat-label>
        <input
          matInput
          [matDatepicker]="startPicker"
          placeholder="Choose a start date"
          formControlName="startDate"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="startPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
        <mat-error
          *ngIf="announcementForm.get('startDate')?.hasError('required')"
        >
          Start Date is required
        </mat-error>
      </mat-form-field>

      <mat-form-field
        appearance="outline"
        class="date-width custom-form-field title-width mt-2"
      >
        <mat-label>Expiration</mat-label>
        <input
          matInput
          [matDatepicker]="expirationPicker"
          placeholder="Choose an expiration date"
        />
        <mat-datepicker-toggle
          matSuffix
          [for]="expirationPicker"
        ></mat-datepicker-toggle>
        <mat-datepicker #expirationPicker></mat-datepicker>
      </mat-form-field>
    </div>

    <div class="mt-3">
      <mat-form-field
        appearance="outline"
        class="custom-form-field title-width"
        style="width: 100%"
      >
        <mat-label>Display Announcement To</mat-label>
        <mat-select [(value)]="selectedAnnouncements" multiple>
          <mat-select-trigger>
            <span *ngFor="let selected of selectedAnnouncements">
              <span
                class="tag"
                [ngStyle]="{ '--tag-color': getTagColor(selected) }"
              >
                {{ selected }}
              </span>
            </span>
          </mat-select-trigger>
          <mat-option
            *ngFor="let announcement of announcementList"
            [value]="announcement"
          >
            <span
              class="tag"
              [ngStyle]="{ '--tag-color': getTagColor(announcement) }"
            >
              {{ announcement }}
            </span>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="row mt-3 g-3">
      <div class="col-12 col-lg-6">
        <button
          mat-stroked-button
          class="w-100 button-width custom-button"
          (click)="openPreview()"
          [disabled]="announcementForm?.invalid"
        >
          Preview
        </button>
      </div>
      <div class="col-12 col-lg-6">
        <button
          class="my-button w-100 button-width"
          (click)="saveAnnouncement()"
          [disabled]="announcementForm?.invalid"
        >
          Save
        </button>
      </div>
    </div>
  </form>
</mat-dialog-content>
