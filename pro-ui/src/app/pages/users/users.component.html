<div class="text-[#262626] w-fit" *ngIf="!showSelectedUser && !createUser">
    <div class="text-xl font-medium mb-6">
        Users
    </div>

    <!-- quick filters -->
    <div class="mt-4">
        <div class="text-sm font-normal uppercase tracking-wide text-gray-800 flex items-center gap-3">
            <div>Quick Filters</div>
            <button class="text-xs text-white border-2 border-button-blue shadow-none py-1 px-2 bg-button-blue rounded-md"
                (click)="resetFilters()">
                Reset Filters
            </button>

        </div>
        <div class="flex items-center my-4">

            <!--user status list-->
            <div class="min-w-[225px] pr-4 py-1 border-r border-r-1 border-r-button-blue">
                <app-select id="status-filter"
                                [fieldLabel]="'User Status'"
                                [anyLabel]="'Status'"
                                [multiSelect]="true"
                                [dropDownValues]="statuses?.dropDownValues || []"
                                [(selectedValues)]="selectedUserStatus"
                                [(anyValueSelected)]="userStatusAnySelected"
                                (selectedValuesChange)="quickFilterChange($event)">
                </app-select>
            </div>

            <!--edit schedule list-->
            <div class="min-w-[225px] px-3 py-1 border-r border-r-1 border-r-button-blue">
                <app-select id="edit-schedule-status-filter"
                                [fieldLabel]="'Edit Schedule Status'"
                                [anyLabel]="'Edit Schedule Status'"
                                [multiSelect]="true"
                                [dropDownValues]="canEditDv"
                                [(selectedValues)]="selectedCanEdit"
                                [(anyValueSelected)]="canEditAnySelected"
                                (selectedValuesChange)="quickFilterChange($event)">
                </app-select>
            </div>

            <!-- trained on/not trained on -->
            <div class="flex items-center gap-4 pl-4 py-1">

                <!--project list-->
                <div class="min-w-[225px]">
                    <app-select id="projects-filter"
                                    [fieldLabel]="'Projects'"
                                    [anyLabel]="'Project'"
                                    [multiSelect]="true"
                                    [dropDownValues]="activeProjectsDv"
                                    [(selectedValues)]="selectedProjects"
                                    [(anyValueSelected)]="projectsAnySelected"
                                    (selectedValuesChange)="projectFilterChange($event)">
                    </app-select>
                </div>

                <!-- trained on/not trained on -->
                <div class="flex flex-col gap-1 text-xs text-button-blue">
                    <label class="flex items-center">
                        <input type="radio" name="trainingStatus" value="1" class="mr-2"
                            [checked]="trainedOn == 1"
                            [disabled]="!projectSelected"
                            (click)="setTrainedOn(1)">
                        Trained On
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="trainingStatus" value="0" class="mr-2"
                            [checked]="trainedOn == 0"
                            [disabled]="!projectSelected"
                            (click)="setTrainedOn(0)">
                        Not Trained On
                    </label>
                </div>

            </div>

        </div>
    </div>

    <!-- batch actions -->
    <div class="mt-4">
        <div class="text-sm font-normal uppercase tracking-wide text-gray-800">
            Batch Actions
        </div>
        <div class="mt-2 mb-4 clearfix w-full">

            <!-- lock/unlock buttons -->
            <div class="float-left flex items-center gap-3 font-bold">

                <!-- lock -->
                <div class="text-xs text-button-blue border-2 border-button-blue shadow-none py-1 px-3 bg-white rounded-md flex cursor-pointer"
                    (click)="executeUserAction(userActions.Lock)">
                    <span class="text-[#0000ff] mr-2">
                        <svg width="12" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M1.31315 13.125C0.992318 13.125 0.717762 13.0109 0.489484 12.7826C0.261206 12.5543 0.146873 12.2796 0.146484 11.9583V6.125C0.146484 5.80417 0.260818 5.52961 0.489484 5.30133C0.718151 5.07306 0.992707 4.95872 1.31315 4.95833H1.89648V3.79167C1.89648 2.98472 2.18096 2.29697 2.7499 1.72842C3.31885 1.15986 4.0066 0.875389 4.81315 0.875C5.61971 0.874612 6.30765 1.15908 6.87698 1.72842C7.44632 2.29775 7.7306 2.9855 7.72982 3.79167V4.95833H8.31315C8.63398 4.95833 8.90873 5.07267 9.1374 5.30133C9.36607 5.53 9.48021 5.80456 9.47982 6.125V11.9583C9.47982 12.2792 9.36568 12.5539 9.1374 12.7826C8.90912 13.0112 8.63437 13.1254 8.31315 13.125H1.31315ZM4.81315 10.2083C5.13398 10.2083 5.40873 10.0942 5.6374 9.86592C5.86607 9.63764 5.98021 9.36289 5.97982 9.04167C5.97943 8.72044 5.86529 8.44589 5.6374 8.218C5.40951 7.99011 5.13476 7.87578 4.81315 7.875C4.49154 7.87422 4.21698 7.98856 3.98948 8.218C3.76198 8.44744 3.64765 8.722 3.64648 9.04167C3.64532 9.36133 3.75965 9.63608 3.98948 9.86592C4.21932 10.0957 4.49387 10.2099 4.81315 10.2083ZM3.06315 4.95833H6.56315V3.79167C6.56315 3.30556 6.39301 2.89236 6.05273 2.55208C5.71246 2.21181 5.29926 2.04167 4.81315 2.04167C4.32704 2.04167 3.91385 2.21181 3.57357 2.55208C3.23329 2.89236 3.06315 3.30556 3.06315 3.79167V4.95833Z" fill="#0680CD"/>
                        </svg>
                    </span>
                    <span>Lock Schedule</span>
                </div>

                <!-- unlock -->
                <div class="text-xs text-button-blue border-2 border-button-blue shadow-none py-1 px-3 bg-white rounded-md flex cursor-pointer"
                    (click)="executeUserAction(userActions.Unlock)">
                    <span class="text-[#8b0000] mr-2">
                        <svg width="15" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M9.47982 0.875C7.86982 0.875 6.56315 2.18167 6.56315 3.79167V4.95833H1.31315C1.00373 4.95833 0.706985 5.08125 0.488193 5.30004C0.269401 5.51883 0.146484 5.81558 0.146484 6.125V11.9583C0.146484 12.2678 0.269401 12.5645 0.488193 12.7833C0.706985 13.0021 1.00373 13.125 1.31315 13.125H8.31315C8.96065 13.125 9.47982 12.6058 9.47982 11.9583V6.125C9.47982 5.81558 9.3569 5.51883 9.13811 5.30004C8.91932 5.08125 8.62257 4.95833 8.31315 4.95833H7.72982V3.79167C7.72982 2.82333 8.51148 2.04167 9.47982 2.04167C10.4482 2.04167 11.2298 2.82333 11.2298 3.79167V4.95833H12.3965V3.79167C12.3965 2.18167 11.0898 0.875 9.47982 0.875ZM4.81315 7.875C5.12257 7.875 5.41932 7.99792 5.63811 8.21671C5.8569 8.4355 5.97982 8.73225 5.97982 9.04167C5.97982 9.68917 5.46065 10.2083 4.81315 10.2083C4.50373 10.2083 4.20699 10.0854 3.98819 9.86662C3.7694 9.64783 3.64648 9.35109 3.64648 9.04167C3.64648 8.73225 3.7694 8.4355 3.98819 8.21671C4.20699 7.99792 4.50373 7.875 4.81315 7.875Z" fill="#DC4A38"/>
                        </svg>
                    </span>
                    <span>Unlock Schedule</span>
                </div>

            </div>

            <!-- add new user button -->
            <div class="float-right">
                <button class="text-xs text-white border-2 border-button-blue shadow-none py-1 px-3 bg-button-blue rounded-md" (click)="createNewUser()">
                    + Add New User
                </button>
            </div>

        </div>
    </div>

    <!-- table -->
    <div class="table text-sm">

        <div class="table-container relative h-[500px] overflow-y-auto border border-[#B5B5B5]">

            <!-- header -->
             <!-- <div class="table-header sticky top-0 bg-white shadow z-10"> -->

             
            <app-table-header
                class="table-row table-header sticky top-0 bg-white z-10"
                [(headerItems)]="headerItems"
                (headerItemsChange)="headerItemsChange($event)"
                [(allSelected)]="allUsersSelected"
                (allSelectedChange)="toggleAllUsersSelected()"></app-table-header>
            <!-- </div> -->
            <!-- table body -->
            @if (allUsers !== undefined
                    && paginatedUsers.length > 0) {

                    @for (user of paginatedUsers; track user) {
                        <div class="table-row">
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 align-middle">
                                <input type="checkbox"
                                    [checked]="user.checked"
                                    (change)="toggleUserSelection(user)">
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ user.dempoid }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ user.preferredfname || user.fname }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ user.preferredlname || user.lname }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ user.emailaddr }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ getStatusDisplay(user.status) }}
                                <!-- <div class="flex items-center">
                                    @if (user.status == '1') {
                                        <span class="text-[#008000] mr-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-check">
                                                <polyline points="20 6 9 17 4 12"></polyline>
                                            </svg>
                                        </span>
                                        <span>Active</span>
                                    }@else {
                                        <span class="text-[#8b0000] mr-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x">
                                                <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </span>
                                        <span>Terminated</span>
                                    }
                                </div> -->

                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ getRoleDisplay(user.role || 0) }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ formatDateOnlyToString(user.tempstartdate) }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">
                                {{ formatDateOnlyToString(user.permstartdate) }}
                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle">

                                <div class="flex items-center">
                                    @if (user.canedit === true) {
                                        <span class="text-[#8b0000] mr-2">
                                            <svg width="14" viewBox="0 0 13 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M9.47982 0.875C7.86982 0.875 6.56315 2.18167 6.56315 3.79167V4.95833H1.31315C1.00373 4.95833 0.706985 5.08125 0.488193 5.30004C0.269401 5.51883 0.146484 5.81558 0.146484 6.125V11.9583C0.146484 12.2678 0.269401 12.5645 0.488193 12.7833C0.706985 13.0021 1.00373 13.125 1.31315 13.125H8.31315C8.96065 13.125 9.47982 12.6058 9.47982 11.9583V6.125C9.47982 5.81558 9.3569 5.51883 9.13811 5.30004C8.91932 5.08125 8.62257 4.95833 8.31315 4.95833H7.72982V3.79167C7.72982 2.82333 8.51148 2.04167 9.47982 2.04167C10.4482 2.04167 11.2298 2.82333 11.2298 3.79167V4.95833H12.3965V3.79167C12.3965 2.18167 11.0898 0.875 9.47982 0.875ZM4.81315 7.875C5.12257 7.875 5.41932 7.99792 5.63811 8.21671C5.8569 8.4355 5.97982 8.73225 5.97982 9.04167C5.97982 9.68917 5.46065 10.2083 4.81315 10.2083C4.50373 10.2083 4.20699 10.0854 3.98819 9.86662C3.7694 9.64783 3.64648 9.35109 3.64648 9.04167C3.64648 8.73225 3.7694 8.4355 3.98819 8.21671C4.20699 7.99792 4.50373 7.875 4.81315 7.875Z" fill="#DC4A38"/>
                                            </svg>
                                        </span>
                                        <span>Unlocked</span>
                                    }@else {
                                        <span class="text-[#0000ff] mr-2">
                                            <svg width="11" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M1.31315 13.125C0.992318 13.125 0.717762 13.0109 0.489484 12.7826C0.261206 12.5543 0.146873 12.2796 0.146484 11.9583V6.125C0.146484 5.80417 0.260818 5.52961 0.489484 5.30133C0.718151 5.07306 0.992707 4.95872 1.31315 4.95833H1.89648V3.79167C1.89648 2.98472 2.18096 2.29697 2.7499 1.72842C3.31885 1.15986 4.0066 0.875389 4.81315 0.875C5.61971 0.874612 6.30765 1.15908 6.87698 1.72842C7.44632 2.29775 7.7306 2.9855 7.72982 3.79167V4.95833H8.31315C8.63398 4.95833 8.90873 5.07267 9.1374 5.30133C9.36607 5.53 9.48021 5.80456 9.47982 6.125V11.9583C9.47982 12.2792 9.36568 12.5539 9.1374 12.7826C8.90912 13.0112 8.63437 13.1254 8.31315 13.125H1.31315ZM4.81315 10.2083C5.13398 10.2083 5.40873 10.0942 5.6374 9.86592C5.86607 9.63764 5.98021 9.36289 5.97982 9.04167C5.97943 8.72044 5.86529 8.44589 5.6374 8.218C5.40951 7.99011 5.13476 7.87578 4.81315 7.875C4.49154 7.87422 4.21698 7.98856 3.98948 8.218C3.76198 8.44744 3.64765 8.722 3.64648 9.04167C3.64532 9.36133 3.75965 9.63608 3.98948 9.86592C4.21932 10.0957 4.49387 10.2099 4.81315 10.2083ZM3.06315 4.95833H6.56315V3.79167C6.56315 3.30556 6.39301 2.89236 6.05273 2.55208C5.71246 2.21181 5.29926 2.04167 4.81315 2.04167C4.32704 2.04167 3.91385 2.21181 3.57357 2.55208C3.23329 2.89236 3.06315 3.30556 3.06315 3.79167V4.95833Z" fill="#0680CD"/>
                                            </svg>
                                        </span>
                                        <span>Locked</span>
                                    }
                                </div>

                            </div>
                            <div class="table-cell border border-1 border-[#B5B5B5] p-2 px-2 align-middle"
                                style="color: #3cbb00;">
                                <mat-icon fontIcon="open_in_new" class="view-icon cursor-pointer align-middle"
                                    (click)="makeSelectedUserVisible(user)"></mat-icon>
                            </div>
                        </div>
                    }
            }
        </div>

    </div>

    <!-- no users found after searching -->
    @if (allUsers !== undefined
            && paginatedUsers.length === 0) {
        <div class="w-full text-sm">No users found</div>
    }

    <!-- table paginator -->
    <app-table-paginator
        [sourceData]="filteredUsers"
        [(currentPage)]="currentPage"
        [(paginatedData)]="paginatedUsers"></app-table-paginator>

</div>


<!--view user-->
<div id="user-profile" *ngIf="showSelectedUser">

  <app-view-user id="view-user-form"
                 [viewUser]="selectedUser"
                 (closewindow)="showSelectedUser = false; getAllUsers()" (userSaved)="onUserAdded($event)" (setUnsavedChanges)="setUnsavedChanges($event)">
  </app-view-user>
</div>

<div *ngIf="createUser">
    <app-add-user (closewindow)="createUser = false" (userSaved)="onUserAdded($event)" [createForm] ="true"/>
</div>
